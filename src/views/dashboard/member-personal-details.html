<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Personal Details</title>

    <!-- links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/dashboard/css/stylesdash.css" />
    <script src="https://kit.fontawesome.com/e6d1f98a15.js" crossorigin="anonymous"></script>

</head>
<body>
  <div class="app-shell">

  <!-- Sidebar -->
      <%- include("partials/sidebar.html") %>


  <!-- Backdrop for mobile -->
  <div class="backdrop" id="backdrop"></div>

  <!-- /member/personal-details -->
<main class="content">
 
   <!-- pop up message -->
        <div id="popup" class="popup hidden"></div>
        
  <!-- Topbar -->
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
    <div>
      <div class="d-flex align-items-center gap-2 mb-2">
        <button class="btn btn-outline-light sidebar-toggle" id="toggleSidebar" type="button">
          <i class="fa-solid fa-bars"></i> Menu
        </button>
      </div>

      <h1 class="h3 text-white mb-1">Personal Details</h1>
      <div class="muted">Keep your contact info, emergency details, and billing info up to date.</div>
    </div>

    <div class="d-flex gap-2 flex-wrap">
      <!-- <button class="btn btn-outline-light" type="button" id="printDetailsBtn">
        Print
      </button> -->
      <button class="btn btn-primary" type="button" id="savePersonalBtn">
        Save Changes
      </button>
    </div>
  </div>

  <!-- Quick status strip -->
  <section class="card glass-card rounded-4 shadow-sm mb-4">
    <div class="card-body p-4">
      <div class="fw-semibold">
            Primary person you want us to call first.
      </div>
      
      <div class="mt-3 row g-3">
        <div class="col-md-3">
          <div class="small-note">Name</div>
          <div class="text-white fw-semibold" id="memberId"><%= member.ecname %></div>
        </div>
        <div class="col-md-3">
          <div class="small-note">Contact</div>
          <div class="text-white fw-semibold" id="primaryPhone"><%= member.phone %></div>
        </div>
        <div class="col-md-3">
          <div class="small-note">Relationship</div>
          <div class="text-white fw-semibold" id="nokSummary"><%= member.relationship %></div>
        </div>
        <div class="col-md-3">
          <div class="small-note">Notes</div>
          <div class="text-white fw-semibold" id="nokSummary"><%= member.ems_notes || "N/A" %></div>
        </div>
      </div>
    </div>
     <!-- <pre><%= JSON.stringify(member, null, 2) %></pre> -->

  </section>

  <!-- Accordion sections (mobile-friendly) -->
  <div class="accordion" id="personalAccordion">

    <!-- Contact & Address -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseContact">
          <i class="fa-solid fa-location-dot me-2"></i> Contact & Address
        </button>
      </h2>
      <div id="collapseContact" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small-note">WhatsApp Number</label>
              <input class="form-control" id="wa-phone" placeholder="+27 ..." value="<%= member.whatsapp_number %>" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Alternate Phone (optional)</label>
              <input class="form-control" id="altPhone" placeholder="+27 ..." value="<%= member.alt_phone %>"/>
            </div>

            <div class="col-md-3">
              <label class="form-label small-note">Date of Birth</label>
              <%  if (member.birthdate) {
                  const date = new Date(member.birthdate);
                  const year = date.getFullYear();
                  const month = String(date.getMonth() + 1).padStart(2, "0");
                  const day = String(date.getDate()).padStart(2, "0");

                  member.birthdate = `${year}-${month}-${day}`;
                } %>
              <input type="date" class="form-control" id="birthDate"  name="birthdate" placeholder="e.g. 2001/12/01" value="<%= member.birthdate || "" %>"/>
            </div>

            <div class="col-md-3">
              <label class="form-label small-note">Gender</label>
              <% const gender = ['Select', 'Male', 'Female', 'Other' ] %>
              <select class="form-select" id="gender" style=" background-color: #3d5c7e73;">
                <% gender.forEach(function(gender) { %>
                 <option value="<%= gender %>" <%= member.gender === gender ? "selected" : "Select" %> >
                    <%= gender %>
                  </option>
                <% }) %>
              </select>
            </div>

            <div class="col-6">
              <label class="form-label small-note">Street Address</label>
              <input class="form-control" id="street" placeholder="House no, street name" value="<%= member.street_address %>"/>
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">City</label>
              <input class="form-control" id="city" placeholder="e.g. Johannesburg" value="<%= member.city %>"/>
            </div>

            <div class="col-md-3">
              <label class="form-label small-note">Province</label>
              <% const provinces = ['Gauteng', 'KwaZulu-Natal','Western Cape', 'Eastern Cape', 'Free State', 'Limpopo', 'Mpumalanga', 'North West', 'Northern Cape' ] %>
              <select class="form-select" id="province" style=" background-color: #3d5c7e73;">
                <% provinces.forEach(function(province) { %>
                 <option value="<%= province %>" <%= member.province === province ? "selected" : "" %> >
                    <%= province %>
                  </option>
                <% }) %>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label small-note">Postal Code</label>
              <input class="form-control" id="postalCode" placeholder="e.g. 2001" value="<%= member.postal_code %>"/>
            </div>

            <div class="col-12">
              <label class="form-label small-note">Notes (optional)</label>
              <textarea class="form-control" id="addressNotes" rows="2"
                placeholder="e.g. Gate code, delivery notes..."><%= member.notes %></textarea>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Emergency Contacts -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseEmergency">
          <i class="fa-solid fa-triangle-exclamation me-2"></i> Emergency Contacts / Next of Kin
        </button>
      </h2>
      <div id="collapseEmergency" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="d-flex flex-column flex-md-row gap-2 align-items-md-center justify-content-between mb-3">
            <div>
              <div class="text-white fw-semibold">Emergency Contact(s)</div>
              <div class="small-note">Add at least one person we can contact if needed.</div>
            </div>
            <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#addEmergencyModal">
              + Add Contact
            </button>
          </div>

          <div class="table-responsive">
            <table class="table table-light table-hover align-middle mb-0">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Relationship</th>
                  <th>Phone</th>
                  <th>Priority</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody id="emergencyTable">
                <tr>
                  <td class="fw-semibold text-dark">—</td>
                  <td class="small-note">—</td>
                  <td class="small-note">—</td>
                  <td><span class="badge text-bg-secondary">None</span></td>
                  <td class="text-end">
                    <button class="btn btn-outline-secondary btn-sm" >Edit</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="small-note mt-3">
            Tip: Set “Primary” for the person you want us to call first.
          </div>

        </div>
      </div>
    </div>

    <!-- Billing / Payment -->
    <!-- <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseBilling">
          <i class="fa-solid fa-credit-card me-2"></i> Billing & Payment Details
        </button>
      </h2>
      <div id="collapseBilling" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small-note">Preferred Payment Method</label>
              <select class="form-select" id="paymentMethod" style=" background-color: #3d5c7e73;">
                <option value="">Select</option>
                <option value="eft">EFT</option>
                <option value="cash">Cash</option>
                <option value="debit">Debit Order</option>
                <option value="card">Card (not stored)</option>
              </select>
              <div class="small-note mt-2">
                We don’t store card numbers here — only payment status and references.
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Billing Email</label>
              <input class="form-control" id="billingEmail" placeholder="e.g. you@email.com" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Billing Reference (optional)</label>
              <input class="form-control" id="billingRef" placeholder="e.g. INV-1042 / Member Ref" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">VAT/Company (optional)</label>
              <input class="form-control" id="companyVat" placeholder="Company name / VAT no." />
            </div>

            <div class="col-12">
              <label class="form-label small-note">Billing Address (optional)</label>
              <textarea class="form-control" id="billingAddress" rows="2"
                placeholder="If different from home address..."></textarea>
            </div>
          </div>

        </div>
      </div>
    </div> -->

    <!-- Health Notes (non-graphic, safety focused) -->
    <div class="accordion-item glass-card rounded-4 shadow-sm mb-3">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed bg-transparent text-white" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseHealth">
          <i class="fa-solid fa-heart-pulse me-2"></i> Health Record (Optional)
        </button>
      </h2>
      <div id="collapseHealth" class="accordion-collapse collapse" data-bs-parent="#personalAccordion">
        <div class="accordion-body p-4">

          <div class="row g-3">

            <div class="d-flex flex-column flex-md-row gap-2 align-items-md-center justify-content-between mb-3">
            <div>
              <div class="text-white fw-semibold"></div>
              <div class="small-note">
                Last updated: 
                  <%= member.health_updated_at 
                        ? new Date(member.health_updated_at).toLocaleDateString()
                        : "Never" %>
              </div>
            </div>
            <button class="btn btn-primary" type="button" data-bs-target="#saveMedInfo">
              Save Info
            </button>
          </div>

            <div class="col-md-4">
              <label class="form-label small-note">Medical Conditions (optional)</label>
              <input class="form-control" id="medicalConditions" placeholder="e.g. asthma, hypertension..."
              value="<%= member.medical_conditions || '' %>" />
            </div>

            <div class="col-md-4">
              <label class="form-label small-note">Surgeries, Injuries or Limitations (optional)</label>
              <input class="form-control" id="injuries" placeholder="e.g. knee pain, shoulder limitation..."
               value="<%= member.injuries || '' %>" />
            </div>

            <div class="col-md-4">
              <label class="form-label small-note">Are You on Any Medication (optional)</label>
              <input class="form-control" id="medication" placeholder="e.g. Pain medication, Antibiotics, Antihypertensives, etc,"
               value="<%= member.medication || '' %>" />
            </div>

            <div class="col-12">
              <label class="form-label small-note">Notes (optional)</label>
              <textarea class="form-control" id="healthNotes" rows="3"
                placeholder="Anything your trainer should know (safe & relevant)."><%= member.health_notes || '' %></textarea>
              <div class="small-note mt-2">
                This is informational only — not medical advice.
              </div>
            </div>

            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="consentShareTrainer" <%= member.consent_share_trainer ? "checked" : "" %>>
                <label class="form-check-label" for="consentShareTrainer">
                  I consent to share these notes with my trainer
                </label>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

  <!-- Add Emergency Contact Modal -->
  <div class="modal fade" id="addEmergencyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content glass-card">
        <div class="modal-header border-0">
          <h5 class="modal-title text-white">Add Emergency Contact</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label small-note">Full Name</label>
              <input class="form-control" id="ecName" placeholder="e.g. Thando Msimango" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Relationship</label>
              <input class="form-control" id="ecRelationship" placeholder="e.g. Parent, Spouse, Sibling" />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Phone</label>
              <input class="form-control" id="ecPhone" placeholder="+27 ..." />
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Priority</label>
              <select class="form-select" id="ecPriority" style=" background-color: #3d5c7e73;">
                <option value="primary">Primary</option>
                <option value="secondary" selected>Secondary</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label small-note">Notes (optional)</label>
              <input class="form-control" id="ecNotes" placeholder="e.g. available after 5pm" />
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" id="saveEmergencyBtn">Save</button>
        </div>
      </div>
    </div>
  </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../assets/dashboard/js/personalDetails.js" defer></script>
 


</div>
</body>
</html>